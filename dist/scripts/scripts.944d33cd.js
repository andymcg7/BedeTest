"use strict";angular.module("bedefrontendtestApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","cgBusy","fiestah.money","LocalStorageModule"]).config(["localStorageServiceProvider",function(a){a.setPrefix("bede")}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/market.html",controller:"MarketCtrl"}).when("/bettingSlip",{templateUrl:"views/bettingSlip.html",controller:"BettingSlipCtrl"}).when("/placedBets",{templateUrl:"views/placedBets.html",controller:"PlacedBetsCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("bedefrontendtestApp").service("addBetService",function(){var a=[],b=function(b){var c=function(a){return a.bet_id===b.bet_id};return a.find(c)?!1:(a.push({bet_id:b.bet_id,event:b.event,name:b.name,odds:b.odds,stake:0}),!0)},c=function(){return a};return{addBet:b,getBets:c}}),angular.module("bedefrontendtestApp").service("displayOddsService",["settingsService",function(a){var b=function(b){if(a.getDecimalOdds()){var c=Number(b.odds.numerator)/Number(b.odds.denominator)+1;return c.toFixed(2)}return 1===b.odds.numerator&&1===b.odds.denominator?"Evens":b.odds.numerator+" to "+b.odds.denominator};return{displayOdds:b}}]),angular.module("bedefrontendtestApp").service("calculatePayoutService",function(){var a=function(a,b){if(isNaN(b)||0===a.denominator)return"";var c=Number(a.numerator),d=Number(a.denominator);return c/d*b+b};return{calculatePayout:a}}),angular.module("bedefrontendtestApp").service("fetchAllBetsService",["$http",function(a){var b=function(){return a.get("https://bedefetechtest.herokuapp.com/v1/markets")};return{fetchAllBets:b}}]),angular.module("bedefrontendtestApp").service("marketStateService",function(){var a,b=[];return{getAvailableEvents:function(){return b},setAvailableEvents:function(a){b=a},getSelectedEvent:function(){return a},setSelectedEvent:function(b){a=b}}}),angular.module("bedefrontendtestApp").service("settingsService",["localStorageService",function(a){var b,c,d=function(c){b=c,a.set("decimalOdds",c)},e=function(){if(void 0===b){var c=a.get("decimalOdds");return void 0===c||null===c?(d(!1),!1):c}return b},f=function(b){c=b,a.set("currency",b)},g=function(){if(void 0===c){var b=a.get("currency");return void 0===b||null===b?(f("£"),"£"):b}return c};return{getDecimalOdds:e,setDecimalOdds:d,getCurrencySymbol:g,setCurrencySymbol:f}}]),angular.module("bedefrontendtestApp").service("placeBetService",["$http",function(a){var b=function(b){var c={bet_id:b.bet_id,odds:b.odds,stake:b.stake};return a.post("https://bedefetechtest.herokuapp.com/v1/bets",c)};return{placeBet:b}}]),angular.module("bedefrontendtestApp").service("placedBetService",["localStorageService","calculatePayoutService",function(a,b){var c=a.get("placedBets");(void 0===c||null===c)&&(c=[]);var d=function(d){c.push({bet_id:d.bet_id,event:d.event,name:d.name,odds:d.odds,stake:d.stake,transaction_id:d.transaction_id,possiblePayout:b.calculatePayout(d.odds,d.stake)}),a.set("placedBets",c)},e=function(){return c};return{addBet:d,getBets:e}}]),angular.module("bedefrontendtestApp").service("calculateBestPayoutService",["calculatePayoutService",function(a){var b=function(b){function c(a){return a.bet_id===f}function d(a){return a.event===e}for(var e,f,g=[],h=0;h<b.length;h++){var i=a.calculatePayout(b[h].odds,b[h].stake);f=b[h].bet_id;var j=g.find(c);j?j.betPayout+=i:g.push({bet_id:b[h].bet_id,event:b[h].event,name:b[h].name,betPayout:i})}var k=[];for(h=0;h<g.length;h++){e=g[h].event;var l=k.find(d);l?g[h].betPayout>l.betPayout&&(l.betPayout=g[h].betPayout):k.push({event:e,betPayout:g[h].betPayout})}var m=0;for(h=0;h<k.length;h++)m+=k[h].betPayout;return m};return{calculateBestPayout:b}}]),angular.module("bedefrontendtestApp").controller("MarketCtrl",["$scope","$http","$location","addBetService","displayOddsService","fetchAllBetsService","marketStateService",function(a,b,c,d,e,f,g){a.displayOdds=e.displayOdds,a.noConnection=!1,a.noBetsFound=!1,this.init=function(){0===g.getAvailableEvents().length?a.loadingPromise=f.fetchAllBets().then(function(b){a.availableEvents=[];for(var c=function(b){for(var c=0;c<a.availableEvents.length;c++)if(a.availableEvents[c].event===b)return a.availableEvents[c];return void 0},d=0;d<b.data.length;d++){var e=c(b.data[d].event);e?e.bets.push(b.data[d]):a.availableEvents.push({event:b.data[d].event,bets:[b.data[d]]})}0===a.availableEvents.length?a.noBetsFound=!0:(g.setAvailableEvents(a.availableEvents),a.eventClicked(a.availableEvents[0]),setTimeout(function(){a.$apply()},0))},function(){a.noConnection=!0}):(a.availableEvents=g.getAvailableEvents(),a.selectedEvent=g.getSelectedEvent(),a.selectedEvent||a.eventClicked(a.availableEvents[0]))},a.eventClicked=function(b){a.selectedEvent=b,g.setSelectedEvent(b)},a.addBet=function(a){d.addBet(a),c.path("bettingSlip")},this.init()}]),angular.module("bedefrontendtestApp").controller("BettingSlipCtrl",["$scope","addBetService","displayOddsService","settingsService","placeBetService","placedBetService",function(a,b,c,d,e,f){a.displayOdds=c.displayOdds,a.currencySymbol=d.getCurrencySymbol(),a.bets=b.getBets(),a.allBetsAddedSuccessfully=!1,a.partialSuccess=!1,a.completeFailure=!1,a.removeBet=function(b){var c=a.bets.indexOf(b);c>-1&&a.bets.splice(c,1)},a.placeBets=function(){var b=a.bets.length,c=0,d=0,i=[];angular.copy(a.bets,i),g();for(var j=0;b>j;j++)!function(g){a.loadingPromise=e.placeBet(i[g]).then(function(b){function d(a){return a.bet_id===b.data.bet_id}c++,a.removeBet(a.bets.find(d)),f.addBet(b.data)},function(){d++})["finally"](function(){c+d===b&&h(c,d)})}(j)};var g=function(){a.allBetsAddedSuccessfully=!1,a.partialSuccess=!1,a.completeFailure=!1},h=function(b,c){g(),0===c?a.allBetsAddedSuccessfully=!0:b>0&&c>0?a.partialSuccess=!0:a.completeFailure=!0}}]),angular.module("bedefrontendtestApp").controller("PlacedBetsCtrl",["$scope","displayOddsService","settingsService","placedBetService","calculateBestPayoutService",function(a,b,c,d,e){a.displayOdds=b.displayOdds,a.currencySymbol=c.getCurrencySymbol(),a.bets=d.getBets(),a.bestPayout=e.calculateBestPayout(a.bets)}]),angular.module("bedefrontendtestApp").controller("SettingsCtrl",["$scope","settingsService",function(a,b){this.init=function(){var c=b.getDecimalOdds();a.radio={},c?a.radio.value="decimal":a.radio.value="traditional"},this.init(),a.currencySymbol=b.getCurrencySymbol(),a.saveSettings=function(){b.setDecimalOdds("decimal"===a.radio.value),b.setCurrencySymbol(a.currencySymbol)}}]),angular.module("bedefrontendtestApp").controller("NavBarCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]);